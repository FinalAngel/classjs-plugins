var Cl=window.Cl||{};!function(a){"use strict";Cl.Autocomplete=new Class({options:{url:!1,minLength:3,easing:"swing",duration:300,delay:300,fx:"slide",closeOnBlur:!1,cls:{field:'input[type="search"]',results:".autocomplete-results",item:".autocomplete-item",close:".autocomplete-close",submit:".autocomplete-submit"},lang:{error:"There has been an error!",empty:"No results."}},initialize:function(b,c){this.selector=b,this.container=a(b),this.options=a.extend(!0,{},this.options,c),this.url=this.options.url?this.options.url:this.container.attr("action"),this.results=this.container.find(this.options.cls.results),this.field=this.container.find(this.options.cls.field),this.callbacks={},this.timer=function(){},this.query="",this._setup()},_setup:function(){var b=this;this.results.hide().attr("aria-hidden",!0),this.field.on("keyup focus paste click",function(){b.search()}),this.container.on("keydown",function(a){var c=a.charCode?parseInt(a.charCode):a.keyCode?parseInt(a.keyCode):0;switch(c){case 27:b.hide();break;case 38:a.preventDefault(),b._focusPreviousResult();break;case 40:a.preventDefault(),b._focusNextResult()}}),this.options.closeOnBlur&&(this.field.on("click",function(a){a.stopPropagation()}),a(document.body).on("click",function(){b.hide()})),a(document).on("click",this.selector+" "+this.options.cls.submit,function(a){a.preventDefault(),b.container.submit()}),a(document).on("click",this.selector+" "+this.options.cls.close,function(a){a.preventDefault(),b.hide()})},show:function(){this.results.attr("aria-hidden",!1),"toggle"===this.options.fx&&this.results.show(),"fade"===this.options.fx&&this.results.fadeIn(this.options.duration),"slide"===this.options.fx&&this.results.slideDown(this.options.duration),this._fire("show")},hide:function(){this.results.attr("aria-hidden",!0),"toggle"===this.options.fx&&this.results.hide(),"fade"===this.options.fx&&this.results.fadeOut(this.options.duration,this.options.transition),"slide"===this.options.fx&&this.results.slideUp(this.options.duration,this.options.transition),this._fire("hide")},search:function(a){var b=this;a=a||this.field.val(),this._validate(a)&&(b.query=a,clearTimeout(b.timer),b.timer=setTimeout(function(){b._request()},b.options.delay)),this._fire("search")},_focusNextResult:function(){var a=this.results.find(this.options.cls.item);if(a.length>0){var b=a.filter(":focus").first();a.index(b)>=0?a.index(b)+1===a.length?this.field.focus():a.eq(a.index(b)+1).focus():a.eq(0).focus()}},_focusPreviousResult:function(){var a=this.results.find(this.options.cls.item);if(a.length>0){var b=a.filter(":focus").first();a.index(b)>=0?0===a.index(b)?this.field.focus():a.eq(a.index(b)-1).focus():a.eq(a.length-1).focus()}},_validate:function(a){return""!==a&&a.length>=this.options.minLength&&a!==this.query},_request:function(){var b=this;a.ajax({type:"GET",url:this.url,dataType:"html",data:this.container.serialize(),success:function(a){a&&a.length>0?b._replace(a):b._showEmpty()},error:function(){b._showError()},headers:{"X-Requested-With":"XMLHttpRequest"}})},_replace:function(a){this.results.html(a),this.results.is(":visible")||this.show()},_showEmpty:function(){this._replace('<p class="autocomplete-message">'+this.options.lang.empty+"</p>")},_showError:function(){this._replace('<p class="autocomplete-message">'+this.options.lang.error+"</p>")},_fire:function(a){return void 0===this.callbacks[a]?!1:(this.callbacks[a](this),void 0)}})}(jQuery);