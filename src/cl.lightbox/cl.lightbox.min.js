/*!
 * @author      Angelo Dini - github.com/finalangel/classjs-plugins
 * @copyright	Distributed under the BSD License.
 * @version     1.2.0
 */// ensure namespace is defined
var Cl=window.Cl||{};(function(e){"use strict";Cl.Lightbox=new Class({options:{prefix:"cl",group:!0,cycle:!0,modal:!0,modalClickable:!0,modalClosable:!0,forceLoad:!1,easing:"swing",duration:300,speed:300,fixed:!0,responsive:!0,ajax:!1,controls:!0,cls:"",opacity:.8,styles:{},dimensions:{initialWidth:50,initialHeight:50,offset:20,width:null,height:null},keys:!0,keyCodes:{close:[27,99],next:[39,110],previous:[37,112]},lang:{close:"Close lightbox",errorMessage:"<p><strong>The requested element could not be loaded.</strong><br />Plase contact us if this error occurs again.</p>",next:"Next",previous:"Previous",status:"Slide {current} of {total}."}},initialize:function(t,n){var r=this;this.body=e(document.body);this.window=e(window);this.options=e.extend(!0,{},this.options,n||t);this.isLoaded=!1;this.isOpen=!1;this.callbacks={};this.dimTimer=function(){};this.triggers=e(t);this.triggers.on("click",function(e){e.preventDefault();r.open.call(r,this)})},_setup:function(){var t=this._tpl(this.options.prefix);this.instance=e(t);this.instance.find("."+this.options.prefix+"-lightbox-controls").html(this._tplControls(this.options.prefix));this.frame=this.instance.filter("."+this.options.prefix+"-lightbox");this.dimmer=this.instance.filter("."+this.options.prefix+"-lightbox-dim");this.content=this.instance.find("."+this.options.prefix+"-lightbox-content");this.loader=this.instance.find("."+this.options.prefix+"-lightbox-loader");this.loadingBay=this.instance.find("."+this.options.prefix+"-lightbox-bay");this.description=this.instance.find("."+this.options.prefix+"-lightbox-description");this.controls=this.instance.find("."+this.options.prefix+"-lightbox-controls");this.nav=this.controls.find("."+this.options.prefix+"-lightbox-navigation");this.closeBtn=this.controls.find("."+this.options.prefix+"-lightbox-close");this.text=this.controls.find("."+this.options.prefix+"-lightbox-text");this.status=this.controls.find("."+this.options.prefix+"-lightbox-status");this.timer=function(){};this.content.css(this.options.styles);this.body.append(this.instance);this._fire("setup")},open:function(e){var t=this;this.isLoaded===!1&&this._setup();setTimeout(function(){t.isLoaded=!0;t._show(this.isOpen?!1:!0);typeof e=="object"&&t._preload(e);typeof e=="string"&&t._preload('<a href="'+e+'"></a>');e===undefined&&this.triggers.length&&t._preload(t.triggers.first());t._attachEvents();t.isOpen=!0;return t._fire("open")},50)},close:function(){this._hide();this._unload();this._detachEvents();this.isOpen=!1;return this._fire("close")},resize:function(e,t){this._resize("animate",e,t);return this._fire("resize")},destroy:function(){this.triggers.off("click");this.instance.remove();return this._fire("destroy")},next:function(){if(!this.collection)return!1;if(!this.options.cycle&&this.index>=this.bound-1)return!1;this.index=this.index+1;this.index>=this.bound&&(this.index=this.options.cycle?0:this.bound-1);this.open(this.collection[this.index]);return this._fire("next")},previous:function(){if(!this.collection)return!1;if(!this.options.cycle&&this.index<=0)return!1;this.index=this.index-1;this.index<0&&(this.index=this.options.cycle?this.bound-1:0);this.open(this.collection[this.index]);return this._fire("previous")},getElement:function(){return this.element||null},getCollection:function(){return this.collection||null},_preload:function(t){function o(){n.element.load(function(){var e=this;n.width=e.width;n.height=e.height;n._load(n.element)}).error(function(){a()})}function u(){e.ajax({url:n.url,method:"get",cache:!1,success:function(t){t='<div class="'+n.options.prefix+'-lightbox-ajax">'+t;t+="</div>";n.element=e(t);n._load(n.element)},error:function(){a()}})}function a(){var e=n._setError(n.options.lang.errorMessage);n.loadingBay.append(e);n._load(e)}function f(t){return e("<iframe />",{src:t,allowtransparency:!0,scrollbars:"no",frameborder:0})}this.element=this.getElement();this.width=null;this.height=null;this.source=e(t);this.url=this.source.attr("href");this.type=this._extract(this.url);var n=this,r={flash:'<embed src="{url}" width="100%" height="100%" type="application/x-shockwave-flash" />',quicktime:""},i=this.url.match(/(width=)([0-9]+)/i),s=this.url.match(/(height=)([0-9]+)/i);this.width=i?i[2]:this.source.data("width")||this.options.dimensions.width;this.height=s?s[2]:this.source.data("height")||this.options.dimensions.height;if(this.options.group&&this.triggers.length>1){this.collection=this.triggers;this.index=this.collection.index(this.source);this.bound=this.collection.length}this.options.preload&&(this.type="preload");this.options.ajax&&(this.type="ajax");switch(this.type){case"image":this.element=e(new Image).attr({src:this.url+"?"+(new Date).getTime(),alt:this.source.attr("title")});o();break;case"flash":this.element=e(r.flash.replace("{url}",this.source.attr("href")));this.loadingBay.append(this.element);this._load(n.element);break;case"ajax":u(this.url);break;case"inline":this.element=e(this.url).clone(!0,!0);this.loadingBay.append(this.element);this.element.length?this._load(this.element):a();break;default:this.element=f(this.url);this._load(n.element)}this._fire("load")},_load:function(e){var t=this;this.width=this.width||e.outerWidth(!0)||480;this.height=this.height||e.outerHeight(!0)||320;this.width>=9999&&(this.width=480);this.height>=9999&&(this.height=320);(e.attr("tagName")!=="IFRAME"||!this.options.forceLoad)&&this.resize(this.width,this.height);clearTimeout(this.timer);this.timer=setTimeout(function(){t._complete.call(t,e)},this.options.duration)},_complete:function(e){var t=this;this.content.html(e.css("visibility","visible").hide().fadeIn(this.options.speed));this.source.attr("title")&&this.description.html(this.source.attr("title")).slideDown(this.options.speed,function(){t.resize()});var n=this.content.find("iframe");if(n.length&&this.options.forceLoad){n.css("visibility","hidden");n.load(function(){t.loader.hide();n.css("visibility","visible")})}else{t.loader.hide();e.show()}this.options.controls&&this._showControls();this.content.find("a").attr("tabindex",0);this._fire("complete")},_unload:function(){this.element.remove();this._fire("unload")},_show:function(e){this.options.modal&&this._showDim();this.content.html("");this.loader.show();this.description.hide();this._accessibility(!0);this.frame.show();e&&this._resize("css",this.options.dimensions.initialWidth,this.options.dimensions.initialHeight);this._hideControls()},_hide:function(){this.options.modal&&this._hideDim();this._accessibility(!1);this.frame.hide()},_extract:function(e){this.extractors={images:/(\.(gif|png|jpe?g|bmp|ico)((#|\?|\&).*)?)$/i,flash:/(\.(swf)((#|\?|\&).*)?)$/i,ajax:/(\.(htm?l|txt)((#|\?|\&).*)?)$/i,inline:/(#[\w'-]+?)$/i};return this.extractors.images.test(e)?"image":this.extractors.flash.test(e)?"flash":this.extractors.ajax.test(e)?"ajax":this.extractors.inline.test(e)?"inline":"iframe"},_attachEvents:function(){var t=this;if(this.isOpen)return!1;this.window.on("resize."+this.options.prefix+"-lightbox",function(){t._resize.call(t,"css")});this.options.fixed&&this.window.on("scroll."+this.options.prefix+"-lightbox",function(){t._resize.call(t,"css")});this.options.modalClickable?this.dimmer.on("click",function(e){e.preventDefault();if(!t.options.modalClosable)return!1;t.close.call(t)}):this.dimmer.css("cursor","default");if(this.options.controls){this.controls.find("."+this.options.prefix+"-lightbox-close a").on("click",function(n){n.preventDefault();if(!t.options.modalClosable)return!1;e(this).show();t.close.call(t)});this.controls.find("."+this.options.prefix+"-lightbox-previous").on("click",function(e){e.preventDefault();t.previous.call(t)});this.controls.find("."+this.options.prefix+"-lightbox-next").on("click",function(e){e.preventDefault();t.next.call(t)});this.content.on("mouseenter",function(){if(!t.collection)return!1;t.nav.find("a").stop().css("opacity",1).fadeIn(t.options.speed)});this.frame.on("mouseleave",function(){if(!t.collection)return!1;t.nav.find("a").stop().fadeOut(t.options.speed)})}this.options.keys?e(document).on("keydown",function(n){e.inArray(parseInt(n.charCode)||parseInt(n.keyCode),t.options.keyCodes.close)>=0&&t.options.modalClosable&&t.close();e.inArray(parseInt(n.charCode)||parseInt(n.keyCode),t.options.keyCodes.next)>=0&&t.next();e.inArray(parseInt(n.charCode)||parseInt(n.keyCode),t.options.keyCodes.previous)>=0&&t.previous()}):e("."+this.options.prefix+"-lightbox-navigation").hide()},_detachEvents:function(){this.window.off("resize."+this.options.prefix+"-lightbox");this.window.off("scroll."+this.options.prefix+"-lightbox");this.dimmer.off("click");this.controls.find("."+this.options.prefix+"-lightbox-close a").off("click");this.controls.find("."+this.options.prefix+"-lightbox-previous").off("click");this.controls.find("."+this.options.prefix+"-lightbox-next").off("click");this.content.off("mouseenter");this.frame.off("mouseleave");e(document).off("keydown."+this.options.prefix+"-lightbox")},_resize:function(t,n,r){t=t||"css";n=parseInt(n)||parseInt(this.width);r=parseInt(r)||parseInt(this.height);var i=this,s=this.window.width(),o=this.window.height(),u=n,a=this.options.dimensions.offset,f=s<=n+a*2&&this.options.responsive,l=o<=this.instance.outerHeight(!0)+a*2;if(f){n=u-(n-s+a*2);this.type==="image"&&(r=Math.floor(r*n/u))}this.content.stop()[t]({width:n,height:r},this.options.duration,this.options.easing);var c=this.instance.find("."+this.options.prefix+"-lightbox-description"),h=this.instance.find("."+this.options.prefix+"-lightbox-controls"),p=c.is(":visible")?c.outerHeight(!0):0;p=p+h.is(":visible")?h.outerHeight(!0):0;var d=(o-r)/2+this.window.scrollTop();d-=(this.content.outerHeight(!0)-this.content.height())/2;if(l){d=a+e(window).scrollTop();this.isFixed=!0}else this.isFixed=!1;d<=a&&(d=a);var v=(s-n)/2;v-=(this.content.outerWidth(!0)-this.content.width())/2;this.isFixed?this.frame.stop()[t]({left:v},this.options.duration,this.options.easing):this.frame.stop()[t]({left:v,top:d-p},this.options.duration,this.options.easing);this.options.modal&&this._resizeDim()},_setError:function(t){t=t||"<p>"+this.options.lang.errorMessage+"</p>";return e(this._tplError(this.options.prefix)).html(t)},_accessibility:function(t){if(t){e("a, input, textarea, select").attr("tabindex",-1);this.instance.find("a").attr("tabindex",1)}else e("a, input, textarea, select").removeAttr("tabindex")},_fire:function(e){if(this.callbacks[e]===undefined)return!1;this.callbacks[e](this)},_showControls:function(){var e=this;this.options.modalClosable&&this.closeBtn.fadeIn();if(!this.collection)return!1;var t=this.options.lang.status;t=t.replace("{current}",this.index+1);t=t.replace("{total}",this.bound);this.status.text(t);this.text.slideDown(this.options.speed,function(){e.resize()})},_hideControls:function(){this.closeBtn.hide();this.text.data("height",this.text.outerHeight(!0));this.text.hide()},_showDim:function(){if(this.dimmer.is(":visible"))return!1;this.dimmer.css("opacity",0).show().animate({opacity:this.options.opacity});this.options.modalClosable?this.dimmer.css("cursor","pointer"):this.dimmer.css("cursor","default")},_hideDim:function(){this.dimmer.fadeOut()},_resizeDim:function(){this.dimmer.css({position:"fixed",width:"100%",height:"100%"})},_tpl:function(e){var t=this.options.cls?" "+this.options.cls:"";return'<div class="'+e+"-lightbox"+t+'" hidden="hidden">'+'	<div class="'+e+'-lightbox-inner">'+'		<div class="'+e+'-lightbox-loader"></div>'+'		<div class="'+e+'-lightbox-content"></div>'+'		<div class="'+e+'-lightbox-description"></div>'+'		<div class="'+e+'-lightbox-controls"></div>'+"	</div>"+'   <div class="'+e+'-lightbox-bay"></div>'+"</div>"+'<div class="'+e+'-lightbox-dim"></div>'},_tplControls:function(e){return'<p class="'+e+'-lightbox-close">'+'   <a href="#close">'+this.options.lang.close+"</a>"+"</p>"+'<p class="'+e+'-lightbox-navigation">'+'   <a class="'+e+'-lightbox-previous" href="#previous">'+this.options.lang.previous+"</a>"+'   <a class="'+e+'-lightbox-next" href="#next">'+this.options.lang.next+"</a>"+"</p>"+'<p class="'+e+'-lightbox-text">'+'   <span class="'+e+'-lightbox-status">'+this.options.lang.status+"</span>"+'   <a class="'+e+'-lightbox-previous" href="#previous">'+this.options.lang.previous+"</a>"+'   <a class="'+e+'-lightbox-next" href="#next">'+this.options.lang.next+"</a>"+"</p>"},_tplError:function(e){return'<div class="'+e+'-lightbox-error"></div>'}})})(jQuery);