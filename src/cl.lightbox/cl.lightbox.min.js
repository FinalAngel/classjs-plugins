/*!
 * @author      Angelo Dini - github.com/finalangel/classjs-plugins
 * @copyright	Distributed under the BSD License.
 * @version     1.1.0
 */// ensure namespace is defined
var Cl=window.Cl||{};(function(e){"use strict";Cl.Lightbox=new Class({options:{prefix:"cl",group:!0,cycle:!0,modal:!0,modalClickable:!0,modalClosable:!0,forceLoad:!1,easing:"linear",duration:300,speed:300,fixed:!0,responsive:!0,ajax:!1,controls:!0,styles:{},dimensions:{initialWidth:50,initialHeight:50,bound:50,offset:20,width:null,height:null},keys:!0,keyCodes:{close:[27,99],next:[39,110],previous:[37,112]},lang:{close:"Close lightbox",errorMessage:"<p><strong>The requested element could not be loaded.</strong><br />Plase contact us if this error occurs again.</p>",next:"Next",previous:"Previous",status:"Slide {current} of {total}."}},initialize:function(t,n){var r=this;this.body=e(document.body);this.window=e(window);this.options=e.extend(!0,{},this.options,n||t);this.isLoaded=!1;this.isOpen=!1;this.callbacks={};this.dimTimer=function(){};this.triggers=e(t);this.triggers.on("click",function(e){e.preventDefault();r.open.call(r,this)})},_setup:function(){this._triggerEvent("setup");this.isLoaded=!0;var t=this._tpl(this.options.prefix);this.instance=e(t);this.instance.find("."+this.options.prefix+"-lightbox-controls").html(this._tplControls(this.options.prefix));this.frame=this.instance.filter("."+this.options.prefix+"-lightbox");this.dimmer=this.instance.filter("."+this.options.prefix+"-lightbox-dim");this.content=this.instance.find("."+this.options.prefix+"-lightbox-content");this.loader=this.instance.find("."+this.options.prefix+"-lightbox-loader");this.loadingBay=this.instance.find("."+this.options.prefix+"-lightbox-bay");this.description=this.instance.find("."+this.options.prefix+"-lightbox-description");this.controls=this.instance.find("."+this.options.prefix+"-lightbox-controls");this.nav=this.controls.find("."+this.options.prefix+"-lightbox-navigation");this.closeBtn=this.controls.find("."+this.options.prefix+"-lightbox-close");this.text=this.controls.find("."+this.options.prefix+"-lightbox-text");this.status=this.controls.find("."+this.options.prefix+"-lightbox-status");this.timer=function(){};this.content.css(this.options.styles);this.body.append(this.instance);this._triggerCallback("setup",this)},open:function(e){this._triggerEvent("open");this.isLoaded||this._setup();this._show(this.isOpen?!1:!0);typeof e=="object"&&this._preload(e);typeof e=="string"&&this._preload('<a href="'+e+'"></a>');e===undefined&&this.triggers.length&&this._preload(this.triggers.first());this._attachEvents();this.isOpen=!0;return this._triggerCallback("open",this)},close:function(){this._triggerEvent("close");this._hide();this._unload();this._detachEvents();this.isOpen=!1;return this._triggerCallback("close",this)},resize:function(e,t){this._triggerEvent("resize");this._resize("animate",e,t);return this._triggerCallback("resize",this)},destroy:function(){this._triggerEvent("destroy");this.triggers.off("click");this.instance.remove();return this._triggerCallback("destroy",this)},next:function(){this._triggerEvent("next");if(!this.collection)return!1;if(!this.options.cycle&&this.index>=this.bound-1)return!1;this.index=this.index+1;this.index>=this.bound&&(this.index=this.options.cycle?0:this.bound-1);this.open(this.collection[this.index]);return this._triggerCallback("next",this)},previous:function(){this._triggerEvent("previous");if(!this.collection)return!1;if(!this.options.cycle&&this.index<=0)return!1;this.index=this.index-1;this.index<0&&(this.index=this.options.cycle?this.bound-1:0);this.open(this.collection[this.index]);return this._triggerCallback("previous",this)},getElement:function(){return this.element||null},getCollection:function(){return this.collection||null},_preload:function(t){function o(){n.element.load(function(){var e=this;n.width=e.width;n.height=e.height;n._load(n.element)}).error(function(){a()})}function u(){e.ajax({url:n.url,method:"get",cache:!1,success:function(t){n.element=e(t);n._load(n.element)},error:function(){a()}})}function a(){var e=n._setError(n.options.lang.errorMessage);n.loadingBay.append(e);n._load(e)}function f(t){return e("<iframe />",{src:t,allowtransparency:!0,scrollbars:"no",frameborder:0})}this._triggerEvent("load");this.element=this.getElement();this.width=null;this.height=null;this.source=e(t);this.url=this.source.attr("href");this.type=this._extract(this.url);var n=this,r={flash:'<embed src="{url}" width="100%" height="100%" type="application/x-shockwave-flash" />',quicktime:""},i=this.url.match(/(width=)([0-9]+)/i),s=this.url.match(/(height=)([0-9]+)/i);this.width=i?i[2]:this.source.data("width")||this.options.dimensions.width;this.height=s?s[2]:this.source.data("height")||this.options.dimensions.height;if(this.options.group&&this.triggers.length>1){this.collection=this.triggers;this.index=this.collection.index(this.source);this.bound=this.collection.length}this.options.preload&&(this.type="preload");switch(this.type){case"image":this.element=e(new Image).attr({src:this.url+"?"+(new Date).getTime(),alt:this.source.attr("title")});o();break;case"flash":this.element=e(r.flash.replace("{url}",this.source.attr("href")));this.loadingBay.append(this.element);this._load(n.element);break;case"ajax":u(this.url);break;case"inline":this.element=e(this.url).clone(!0,!0);this.loadingBay.append(this.element);this.element.length?this._load(this.element):a();break;default:this.element=f(this.url);this._load(n.element)}this._triggerCallback("load",this)},_load:function(e){var t=this;this.width=this.width||e.outerWidth(!0)||480;this.height=this.height||e.outerHeight(!0)||320;this.width>=9999&&(this.width=480);this.height>=9999&&(this.height=320);(e.attr("tagName")!=="IFRAME"||!this.options.forceLoad)&&this.resize(this.width,this.height);clearTimeout(this.timer);this.timer=setTimeout(function(){t._complete.call(t,e)},this.options.duration)},_complete:function(e){this._triggerEvent("complete");var t=this;this.content.html(e.css("visibility","visible").hide().fadeIn(this.options.speed));this.source.attr("title")&&this.description.html(this.source.attr("title")).slideDown(this.options.speed);var n=this.content.find("iframe");if(n.length&&this.options.forceLoad){n.css("visibility","hidden");n.load(function(){t.loader.hide();n.css("visibility","visible")})}else{t.loader.hide();e.show()}this.options.controls&&this._showControls();this.content.find("a").attr("tabindex",0);this._triggerCallback("complete",this)},_unload:function(){this._triggerEvent("unload");this.element.remove();this._triggerCallback("unload",this)},_show:function(e){this.options.modal&&this._showDim();this.content.html("");this.loader.show();this.description.hide();this._accessibility(!0);this.frame.show();e&&this._resize("css",this.options.dimensions.initialWidth,this.options.dimensions.initialHeight);this._hideControls()},_hide:function(){this.options.modal&&this._hideDim();this._accessibility(!1);this.frame.hide()},_extract:function(e){this.extractors={images:/(\.(gif|png|jpe?g|bmp|ico)((#|\?|\&).*)?)$/i,flash:/(\.(swf)((#|\?|\&).*)?)$/i,ajax:/(\.(htm?l|txt)((#|\?|\&).*)?)$/i,inline:/(#[\w'-]+?)$/i};return this.extractors.images.test(e)?"image":this.extractors.flash.test(e)?"flash":this.extractors.ajax.test(e)?"ajax":this.extractors.inline.test(e)?"inline":"iframe"},_attachEvents:function(){var t=this;if(this.isOpen)return!1;this.window.on("resize."+this.options.prefix+".lightbox",function(){t._resize.call(t,"css")});this.options.fixed&&this.window.on("scroll."+this.options.prefix+".lightbox",function(){t._resize.call(t,"css")});if(this.options.modal){this.window.on("resize."+this.options.prefix+".lightboxdim",function(){t._resizeDim.call(t,!1)});this._resizeDim(!0)}this.options.modalClickable?this.dimmer.on("click",function(e){e.preventDefault();if(!t.options.modalClosable)return!1;t.close.call(t)}):this.dimmer.css("cursor","default");if(this.options.controls){this.controls.find('a[href="#close"]').on("click",function(n){n.preventDefault();if(!t.options.modalClosable)return!1;e(this).show();t.close.call(t)});this.controls.find('a[href="#previous"]').on("click",function(e){e.preventDefault();t.previous.call(t)});this.controls.find('a[href="#next"]').on("click",function(e){e.preventDefault();t.next.call(t)});this.content.on("mouseenter",function(){if(!t.collection)return!1;t.nav.find("a").stop().css("opacity",1).fadeIn(t.options.speed)});this.frame.on("mouseleave",function(){if(!t.collection)return!1;t.nav.find("a").stop().fadeOut(t.options.speed)})}this.options.keys?e(document).on("keydown",function(n){e.inArray(parseInt(n.charCode)||parseInt(n.keyCode),t.options.keyCodes.close)>=0&&t.options.modalClosable&&t.close();e.inArray(parseInt(n.charCode)||parseInt(n.keyCode),t.options.keyCodes.next)>=0&&t.next();e.inArray(parseInt(n.charCode)||parseInt(n.keyCode),t.options.keyCodes.previous)>=0&&t.previous()}):e("."+this.options.prefix+"-lightbox-navigation").hide()},_detachEvents:function(){this.window.off("resize."+this.options.prefix+".lightboxdim");this.dimmer.off("click");this.window.off("resize."+this.options.prefix+".lightbox");this.window.off("scroll."+this.options.prefix+".lightbox");this.controls.find('a[href="#close"]').off("click");this.controls.find('a[href="#previous"]').off("click");this.controls.find('a[href="#next"]').off("click");this.content.off("mouseenter");this.frame.off("mouseleave");e(document).off("keydown")},_triggerCallback:function(e,t){if(this.callbacks[e]===undefined)return!1;this.callbacks[e](t)},_triggerEvent:function(t){e.event.trigger(this.options.prefix+"-lightbox-"+t)},_resize:function(t,n,r){t=t||"css";n=parseInt(n)||parseInt(this.width);r=parseInt(r)||parseInt(this.height);var i=this.window.width(),s=this.window.height(),o=n,u=r,a=e(this.controls.find("."+this.options.prefix+"-lightbox-text")).data("height")||0;if(!this.collection||!this.options.controls)a=0;if(i<=n+this.options.dimensions.bound&&this.options.responsive){n=o-(n-i+this.options.dimensions.bound);this.type==="image"&&(r=Math.floor(r*n/o))}if(s<=r+this.options.dimensions.bound+a&&this.options.responsive){r=u-(r-s+this.options.dimensions.bound)-a;this.type==="image"&&(n=Math.floor(n*r/u))}this.content.stop()[t]({width:n,height:r},this.options.duration,this.options.easing);var f=this.options.dimensions.offset/2,l=(i-n)/2-f,c=(s-r)/2+this.window.scrollTop()-f-a/2;l-=(this.content.outerWidth(!0)-this.content.width())/2;c-=(this.content.outerHeight(!0)-this.content.height())/2;this.frame.stop()[t]({left:l,top:c},this.options.duration,this.options.easing)},_setError:function(t){t=t||"<p>"+this.options.lang.errorMessage+"</p>";return e(this._tplError(this.options.prefix)).html(t)},_accessibility:function(t){if(t){e("a, input, textarea, select").attr("tabindex",-1);this.instance.find("a").attr("tabindex",1)}else e("a, input, textarea, select").removeAttr("tabindex")},_showControls:function(){this.options.modalClosable&&this.closeBtn.fadeIn();if(!this.collection)return!1;var e=this.options.lang.status;e=e.replace("{current}",this.index+1);e=e.replace("{total}",this.bound);this.status.text(e);this.text.slideDown(this.options.speed)},_hideControls:function(){this.closeBtn.hide();this.text.data("height",this.text.outerHeight(!0));this.text.hide()},_showDim:function(){e.browser&&e.browser.msie&&e.browser.version<=8?this.dimmer.show():this.dimmer.fadeIn();this.options.modalClosable?this.dimmer.css("cursor","pointer"):this.dimmer.css("cursor","default")},_hideDim:function(){e.browser&&e.browser.msie&&e.browser.version<=8?this.dimmer.hide():this.dimmer.fadeOut()},_resizeDim:function(){var t=this,n=e.browser&&e.browser.msie&&e.browser.version<=7?21:0;this.dimmer.css({position:"fixed",width:"100%",height:"100%"});clearTimeout(this.dimTimer);this.dimTimer=setTimeout(function(){var r=e(document).height()-e(window).height(),i=e(document).width()-e(window).width();t.dimmer.css({position:"absolute",width:e(window).width()+i-n,height:e(window).height()+r})},100)},_tpl:function(e){return'<div class="'+e+'-lightbox" hidden="hidden">'+'	<div class="'+e+'-lightbox-inner">'+'		<div class="'+e+'-lightbox-loader"></div>'+'		<div class="'+e+'-lightbox-content"></div>'+'		<div class="'+e+'-lightbox-description"></div>'+'		<div class="'+e+'-lightbox-controls"></div>'+"	</div>"+'   <div class="'+e+'-lightbox-bay"></div>'+"</div>"+'<div class="'+e+'-lightbox-dim"></div>'},_tplControls:function(e){return'<p class="'+e+'-lightbox-close">'+'   <a href="#close">'+this.options.lang.close+"</a>"+"</p>"+'<p class="'+e+'-lightbox-navigation">'+'   <a class="'+e+'-lightbox-previous" href="#previous">'+this.options.lang.previous+"</a>"+'   <a class="'+e+'-lightbox-next" href="#next">'+this.options.lang.next+"</a>"+"</p>"+'<p class="'+e+'-lightbox-text">'+'   <span class="'+e+'-lightbox-status">'+this.options.lang.status+"</span>"+'   <a class="'+e+'-lightbox-previous" href="#previous">'+this.options.lang.previous+"</a>"+'   <a class="'+e+'-lightbox-next" href="#next">'+this.options.lang.next+"</a>"+"</p>"},_tplError:function(e){return'<div class="'+e+'-lightbox-error"></div>'}})})(jQuery);